{% extends 'core/base.html' %}
{% load static %}
{% load humanize %}
{% block title %}{{title}}{% endblock title %}
{% block content %}
  <main class='block block--centered'>
    <div>
      {% if form_filter %}
        <header class="block block--centered">
          {% include 'costcenter-in-year-data-filter-form.html' %}
      {% else %}
        <header class="frame">
          <h2>{{title}}</h2>
      {% endif %}
    </header>
    <section class="summary block--spaced">
      {{table|safe}}
    </section>
  </div>
  </main>

  <script type="text/javascript" src="{% static 'js/reports/table-formatter.js'%}" ></script>
  {% if data|length > 2 %}
  <div id="chart_in_year"><div class="chart__title">NP In Year</div></div>

  {{data|json_script:"json_data"}}
  <script type="module">
    import { Chart, ChartHandler} from "/static/js/barchart.js";
    const data=JSON.parse(JSON.parse(document.getElementById('json_data').textContent))
    const data_quarterly=data.map(function(e) {
      console.log(e)
      return {Period:e.Period,Spent:e.Spent,Commitment:e.Commitment, PC:e['Pre Commitment'],FR:e['Fund Reservation']}
    });
    console.log("---------------")
    console.log(data_quarterly)
    console.log("---------------")
    const colors={Spent:'#882255',CO:'#ddcc77',PC:'#afeeee',FR:'#fa8072'};
    data_quarterly.columns = Object.keys(data_quarterly[0]);
    var config = {
      color:colors,
      style: { type: "bar", barmode: "stacked", orientation: "v", width: 700, height: 300 },
      legend: { visibility: "show", orient: "v" }
    };
    Chart("chart_in_year", data_quarterly, config);
    ChartHandler.ajust_chart_width()
  </script>
  {% endif %}

{% endblock content%}
