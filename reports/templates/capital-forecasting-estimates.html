{% extends 'core/base.html' %}
{% load humanize %}
{% block title %}Search Capital Forecasting Estimates{% endblock title %}
{% block content %}
<main class='block block--centered'>
    {% if not table %}
    <div class="alert alert--info">There are no data to display</div>
    {% endif %}
    <h1>Capital Forecasting Estimates</h1>
    {% if form_filter %}
    {% include "core/capital-forecasting-filter.html" %}
    {% endif %}
{% if data %}
<div id="chart_estimates"><div class="chart__title">Capital Forecasting Estimates {{capital_project}} {{fund}} FY {{fy}}</div></div>
{{table|safe}}
{% autoescape off %}
    <script type="module">
        import { Chart,ChartHandler } from "/static/js/barchart.js";
        const data={{data|safe}}
        const data_estimates = data.map(function (e) {
            return { Quarter: e.quarter, LE: e.LE,  MLE: e.MLE,HE: e.HE };
        });
        data_estimates.columns = Object.keys(data_estimates[0]);
        var config = {
            style: { type: "bar", barmode: "grouped", orientation: "v", width: 500, height: 300 },
            legend: { visibility: "show", orient: "v" },
            threshold: [{name:"Q4 Working Plan",value:d3.max(data.map((d) => parseFloat(d["Working Plan"])))}],
        };
        Chart("chart_estimates", data_estimates, config);
        ChartHandler.ajust_chart_width()
    </script>
    {% endautoescape %}
    {% endif %}
</main>
{% endblock content %}